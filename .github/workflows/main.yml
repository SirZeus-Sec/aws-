name: gitleaks
on:
  pull_request:
  push:
  workflow_dispatch:
  schedule:
    - cron: "0 4 * * *" # Run once a day at 4 AM UTC

jobs:
  scan:
    name: gitleaks
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Run Gitleaks Secret Scan
        uses: gitleaks/gitleaks-action@v2
        env:
          GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }}

      - name: Run Gitleaks Secret Scan
        id: gitleaks_scan
        uses: gitleaks/gitleaks-action@v2
        env:
          GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }}

      - name: Send Discord Notification if Secrets Found
        if: failure() # Run only if Gitleaks finds secrets
        uses: stegzilla/discord-notify@v2
        with:
          webhook_url: "https://discord.com/api/webhooks/1340834527752228864/HqY9-ZbTALHz6mKaSX9SgQV6FvMU6wF3FZ5m-DDyChdynGRR2JCbvPTVlIwp_9fznxGb"
          title: "ðŸš¨ Gitleaks Scan Detected Secrets!"
          message: |
            **Repository:** ${{ github.repository }}
            **Branch:** ${{ github.ref_name }}
            **Commit:** [`${{ github.sha }}`](https://github.com/${{ github.repository }}/commit/${{ github.sha }})
            **Action Required:** ðŸš¨ Rotate this secret ASAP if it's real.  
            ðŸ›‘ If false positive, add this to `.gitleaksignore`
          include_image: true
          avatar_url: "https://avatars.githubusercontent.com/u/54240749?s=200&v=4"
          username: "Gitleaks Notifier"

